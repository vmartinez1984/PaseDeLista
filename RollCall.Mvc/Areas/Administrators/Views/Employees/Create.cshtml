@model RollCall.Dto.EmployeeDto

@{
    ViewData["Title"] = "Agregar empleado";
}

<div class="card border-left-success shadow h-100 py-2">
    <div class="card-body">
        <div class="row">
            <div class="col-12">
                <h6 class="m-0 font-weight-bold text-success">
                    <i class="fa fa-plus-circle"></i>
                    Agregar nuevo empleado
                </h6>
            </div>
        </div>
        <hr />

        <form asp-action="Create" id="formEmployee">
            <input type="hidden" name="ListSecurityQuestions[]" />
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="row">
                <div class="form-group col-md-12">
                    <label asp-for="Name" class="control-label"></label>
                    <input asp-for="Name" class="form-control" autofocus />
                    <span asp-validation-for="Name" class="text-danger"></span>
                </div>
                <div class="form-group col-md-12">
                    <label asp-for="LastName" class="control-label"></label>
                    <input asp-for="LastName" class="form-control" />
                    <span asp-validation-for="LastName" class="text-danger"></span>
                </div>
            </div>

            @*<div class="form-group">
                <label asp-for="PhotoInBase64" class="control-label"></label>
                <input asp-for="PhotoInBase64" class="form-control" />
                <span asp-validation-for="PhotoInBase64" class="text-danger"></span>
                </div>*@
            <div class="row">
                <div class="form-group col-md-6">
                    <label asp-for="AreaId" class="control-label"></label>
                    <select asp-for="AreaId" class="form-control" asp-items="@(new SelectList(ViewBag.AreaList,"Id","Name"))">
                        <option value="">Seleccione</option>
                    </select>
                    <span asp-validation-for="AreaId" class="text-danger"></span>
                </div>
                <div class="form-group col-md-6">
                    <label asp-for="ScheduleId" class="control-label"></label>
                    <select asp-for="ScheduleId" class="form-control" asp-items="@(new SelectList(ViewBag.ScheduleList,"Id","Schedule"))">
                        <option value="">Seleccione</option>
                    </select>
                    <span asp-validation-for="ScheduleId" class="text-danger"></span>
                </div>
            </div>

            <h6 class="text-info">Preguntas de seguridad</h6>
            <h6 class="text-info">Agregue al menos <span id="numberOfQuestions">5</span> preguntas con su respuesta, estas serán utilizadas para confirmar su asistencia</h6>

            <div class="row">
                <div class="form-group col-md-4">
                    <label class="control-label">Pregunta</label>
                    <input id="question" class="form-control"  maxlength="150" onkeypress="verifyEmptyQuestion()"/>
                    <span class="text-danger" id="questionValidation"></span>
                </div>
                <div class="form-group col-md-7">
                    <label class="control-label">Respuesta</label>
                    <input id="answer" class="form-control" maxlength="150" onkeypress="verifyEmptyAnswer(event)"/>
                    <span class="text-danger" id="answerValidation"></span>
                </div>
                <div class="form-group col-md-1">
                    <label class="control-label">&nbsp;</label>
                    <button type="button" class="btn btn-success form-control" onclick="addSecurityQuestion();">
                        <i class="fa fa-plus"></i>
                    </button>
                </div>
            </div>

            <div id="divListSecurityQuestions"></div>

            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Pregunta</th>
                        <th>Respuesta</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="tbody">
                </tbody>
            </table>

            <span id="spanValidationOfList" class="text-danger">Agregue 5 preguntas de seguridad</span>
            <br/>
            <br/>

            <div class="form-group">
                <button type="submit" class="btn btn-primary">
                    <i class="fa fa-save"></i>
                    Guardar
                </button>
            </div>
        </form>
    </div>

</div>

<br />
<div>
    <a asp-action="Index">
        <i class="fa fa-list"></i>
        Regresar a la lista
    </a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
<script>
    var ListSecurityQuestions = new Array();

    $("#spanValidationOfList").hide();
    function addSecurityQuestion(){
        var textAnswer;
        var textQuestion;

        textAnswer = document.getElementById("answer");
        textQuestion = document.getElementById("question");
        if(validateSecurityQuestion(textAnswer,textQuestion))
            return;
        securityQuestion = new Object();
        securityQuestion.answer = textAnswer.value;
        securityQuestion.question = textQuestion.value;
        ListSecurityQuestions.push(securityQuestion);
        textAnswer.value = "";
        textQuestion.value = "";
        setInputSecurityQuestion();
        setListSecurityQuestion();
        $("#spanValidationOfList").hide();
        textQuestion.focus();
        //console.log(ListSecurityQuestions);
    }

    function validateSecurityQuestion(textAnswer,textQuestion){
        $("#answerValidation").hide();
        $("#questionValidation").hide();
        if(textAnswer.value == ""){
            $("#answerValidation").show();
            document.getElementById("answerValidation").innerText = "El campo no puede ir vacio";
        }
        if(textQuestion.value == ""){
            $("#questionValidation").show();
            document.getElementById("questionValidation").innerText = "El campo no puede ir vacio";
        }
        if(textAnswer.value == "" || textQuestion.value == ""){
            return true;
        }else{
            return false;
        }
    }

    function setInputSecurityQuestion(){
        document.getElementById("divListSecurityQuestions").innerHTML = "";
        for(i=0; i< ListSecurityQuestions.length; i++){
            var inputHiddenQuestion;
            var inputHiddenAnswer;

            inputHiddenQuestion = document.createElement("input");
            inputHiddenQuestion.setAttribute("type","hidden");
            inputHiddenQuestion.setAttribute("name","securityQuestions["+i+"].Question");
            inputHiddenQuestion.value = ListSecurityQuestions[i].question;
            document.getElementById("divListSecurityQuestions").appendChild(inputHiddenQuestion);

            inputHiddenAnswer = document.createElement("input");
            inputHiddenAnswer.setAttribute("type","hidden");
            inputHiddenAnswer.setAttribute("name","securityQuestions["+i+"].Answer");
            inputHiddenAnswer.value = ListSecurityQuestions[i].question;
            document.getElementById("divListSecurityQuestions").appendChild(inputHiddenAnswer);
        }
    }

    function setListSecurityQuestion(){
        document.getElementById("tbody").innerHTML = "";
        for(i=0; i< ListSecurityQuestions.length; i++){
            //console.log(ListSecurityQuestions[i].answer);
            var code;

            code = "<tr>";
            code += "<td>" + ListSecurityQuestions[i].question + "</td>";
            code += "<td>" + ListSecurityQuestions[i].answer + "</td>";
            code += "<td><button type='button' class='btn btn-danger' onclick='deleteSecurityQuestion(" + i + ")'><i class='fa fa-times'></i></button></td>"
            code += "</tr>";

            document.getElementById("tbody").innerHTML += code;
        }
    }

    function deleteSecurityQuestion(index){
        //console.log(index);
        ListSecurityQuestions.splice(index,1);
        setInputSecurityQuestion();
        setListSecurityQuestion();
    }

    document.getElementById("formEmployee").addEventListener("submit", verifyListSecurityQuestions);

    function verifyListSecurityQuestions(event){
        debugger;
        if(ListSecurityQuestions.length < 5){            
            $("#spanValidationOfList").show();
            document.getElementById("spanValidationOfList").innerText = "Agregue " + (5 - ListSecurityQuestions.length) + " Preguntas de seguridad"
            event.preventDefault();
        }
    }

    function verifyEmptyQuestion(){
        if(document.getElementById("question").value.length > 0){
             $("#questionValidation").hide();
        }
    }

    function verifyEmptyAnswer(e){
        if(document.getElementById("answer").value.length > 0){
             $("#answerValidation").hide();
        }
        if (e.key === 'Enter' || e.keyCode === 13) {
            addSecurityQuestion();
        }
    }
</script>
}